CREATE DATABASE AIRLINE_FLIGHT;
USE AIRLINE_FLIGHT;

CREATE TABLE FLIGHTS(
FLNO INT PRIMARY KEY,
F_FROM VARCHAR(30) NOT NULL,
F_TO VARCHAR(30) NOT NULL,
DISTANCE INT,
DEPARTS TIMESTAMP,
ARRIVES TIMESTAMP,
PRICE FLOAT(2)
);

CREATE TABLE AIRCRAFT(
AID INTEGER PRIMARY KEY,
ANAME VARCHAR(30),
CRUISINGRANGE INTEGER
);

CREATE TABLE EMPLOYEE(
EID INTEGER PRIMARY KEY,
ENAME VARCHAR(15),
SALARY FLOAT(2)
);

CREATE TABLE CERTIFIED(
EID INTEGER NOT NULL,
AID INTEGER NOT NULL,
PRIMARY KEY(EID,AID),
FOREIGN KEY(EID) REFERENCES EMPLOYEE(EID),
FOREIGN KEY(AID) REFERENCES AIRCRAFT(AID)
);

INSERT INTO AIRCRAFT VALUES 
(101,'747',3000),
(102,'Boeing',900),
(103,'647',800),
(104,'Dreamliner',10000),
(105,'Boeing',3500),
(106,'707',1500),
(107,'Dream', 120000);

INSERT INTO EMPLOYEE VALUES
(701,'A',50000),
(702,'B',100000),
(703,'C',150000),
(704,'D',90000),
(705,'E',40000),
(706,'F',60000),
(707,'G',90000);

INSERT INTO CERTIFIED VALUES
(701,101),
(701,102),
(701,106),
(701,105),
(702,104),
(703,104),
(704,104),
(702,107),
(703,107),
(704,107),
(702,101),
(703,105),
(704,105),
(705,103);

INSERT INTO FLIGHTS VALUES
(101,'Bangalore','Delhi',2500,'2005-05-13 07:15:31','2005-05-13 17:15:31',5000),
(102,'Bangalore','Lucknow',3000, '2005-05-13 07:15:31', '2005-05-13 11:15:31',6000),
(103,'Lucknow','Delhi',500,'2005-05-13 12:15:31', '2005-05-13 17:15:31',3000),
(107,'Bangalore','Frankfurt',8000, '2005-05-13 07:15:31', '2005-05-13 22:15:31',60000),
(104,'Bangalore','Frankfurt',8500, '2005-05-13 07:15:31', '2005-05-13 23:15:31',75000),
(105,'Kolkata','Delhi',3400, '2005-05-13 07:15:31', '2005-05-13 09:15:31',7000);

SELECT * FROM FLIGHTS;
SELECT * FROM EMPLOYEE;
SELECT * FROM CERTIFIED;
SELECT * FROM AIRCRAFT;

/*QUERY-1*/

SELECT DISTINCT A.ANAME FROM AIRCRAFT A, EMPLOYEE E, CERTIFIED C
WHERE A.AID=C.AID AND C.EID=E.EID AND E.SALARY>80000 AND A.ANAME NOT IN
 ( SELECT DISTINCT A1.ANAME FROM AIRCRAFT A1, EMPLOYEE E1, CERTIFIED C1 WHERE A1.AID=C1.AID AND C1.EID=E1.EID AND E1.SALARY<80000);

SELECT DISTINCT A.ANAME FROM AIRCRAFT A, EMPLOYEE E, CERTIFIED C
WHERE A.AID=C.AID AND C.EID=E.EID AND E.SALARY>80000;

/*QUERY-2*/

SELECT  ENAME, E.EID, MAX(CRUISINGRANGE) FROM EMPLOYEE E, AIRCRAFT A ,CERTIFIED C
WHERE A.AID=C.AID AND C.EID=E.EID AND 3< (SELECT COUNT(*) FROM CERTIFIED C2 WHERE C.EID=C2.EID  );
 
 /*OR*/
 
SELECT  ENAME, E.EID, MAX(CRUISINGRANGE) FROM EMPLOYEE E, AIRCRAFT A ,CERTIFIED C
WHERE A.AID=C.AID AND C.EID=E.EID GROUP BY C.EID HAVING COUNT(*)>3;

/*QUERY-3*/

SELECT ENAME FROM EMPLOYEE 
WHERE SALARY < (SELECT MIN(PRICE) FROM FLIGHTS WHERE F_FROM='BANGALORE'AND F_TO='FRANKFURT');

/*QUERY-4*/

SELECT ANAME , AVG(SALARY) FROM EMPLOYEE E, AIRCRAFT A,CERTIFIED C
WHERE A.AID=C.AID AND C.EID=E.EID AND CRUISINGRANGE>1000 GROUP BY (C.AID);


/*QUERY-5*/

SELECT DISTINCT ENAME FROM EMPLOYEE E, AIRCRAFT A,CERTIFIED C
WHERE A.AID=C.AID AND C.EID=E.EID AND ANAME='Boeing';

/*QUERY-6*/

SELECT AID FROM AIRCRAFT
WHERE CRUISINGRANGE >= (SELECT MIN(DISTANCE) FROM FLIGHTS WHERE F_FROM='BANGALORE' AND F_TO='FRANKFURT' );

/*QUERY-7*/

SELECT F.DEPARTS
FROM FLIGHTS F
WHERE F.FLNO IN ( ( SELECT F0.FLNO
 FROM FLIGHTS F0
 WHERE F0.F_FROM = 'Bangalore' AND F0.F_TO = 'Delhi'
 AND EXTRACT(HOUR from F0.ARRIVES) < 18 )
 UNION
( SELECT F0.FLNO
 FROM FLIGHTS F0, FLIGHTS F1
 WHERE F0.F_FROM = 'Bangalore' AND F0.F_TO <> 'Delhi'
 AND F0.F_TO = F1.F_FROM AND F1.F_TO = 'Delhi'
 AND F1.DEPARTS > F0.ARRIVES
 AND EXTRACT(HOUR from F1.ARRIVES) < 18)
 UNION
( SELECT F0.FLNO
 FROM FLIGHTS F0, FLIGHTS F1, FLIGHTS F2
 WHERE F0.F_FROM = 'Bangalore'
 AND F0.F_TO = F1.F_FROM
 AND F1.F_TO = F2.F_FROM
 AND F2.F_TO = 'Delhi'
 AND F0.F_TO <> 'Delhi'
 AND F1.F_TO <> 'Delhi'
 AND F1.DEPARTS > F0.ARRIVES
 AND F2.DEPARTS > F1.ARRIVES
 AND EXTRACT(HOUR from F2.ARRIVES) < 18));


/*QUERY-8*/

SELECT DISTINCT ENAME ,SALARY FROM EMPLOYEE 
WHERE EID NOT IN (SELECT DISTINCT EID FROM CERTIFIED)
AND SALARY >= (SELECT AVG(SALARY) FROM EMPLOYEE E,CERTIFIED C WHERE E.EID IN (C.EID) );

