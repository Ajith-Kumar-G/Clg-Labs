CREATE DATABASE STUDENT_FACULTY;
USE STUDENT_FACULTY;

CREATE TABLE STUDENT(
SNUM INT PRIMARY KEY,
SNAME VARCHAR(30),
MAJOR VARCHAR(30),
LVL VARCHAR(30),
AGE INT
);

CREATE TABLE FACULTY (
FID INT PRIMARY KEY,
FNAME  VARCHAR(30),
DEPTID INT
);

CREATE TABLE CLASS(
CNAME  VARCHAR(30) PRIMARY KEY,
MEETS_AT TIMESTAMP,
ROOM VARCHAR(30),
FID INT,
FOREIGN KEY(FID) REFERENCES FACULTY(FID)
);

CREATE TABLE ENROLLED(
SNUM INT,
CNAME VARCHAR(30),
FOREIGN KEY(SNUM) REFERENCES STUDENT(SNUM),
FOREIGN KEY(CNAME) REFERENCES CLASS(CNAME),
PRIMARY KEY(SNUM,CNAME)
);
INSERT INTO STUDENT VALUES
(1, 'jhon', 'CS', 'Sr', 19),
(2, 'Smith', 'CS', 'Jr', 20),
(3 , 'Jacob', 'CV', 'Sr', 20),
(4, 'Tom ', 'CS', 'Jr', 20),
(5, 'Rahul', 'CS', 'Jr', 20),
(6, 'Rita', 'CS', 'Sr', 21);

SELECT * FROM STUDENT;

INSERT INTO FACULTY VALUES
(11, 'Harish', 1000),
(12, 'MV', 1000),
(13 , 'Mira', 1001),
(14, 'Shiva', 1002),
(15, 'Nupur', 1000);

SELECT * FROM FACULTY;

INSERT INTO CLASS VALUES
('class1', '12/11/15 10:15:16', 'R1', 14),
('class2', '12/11/15 10:15:20', 'R2', 12),
('class3', '12/11/15 10:15:25', 'R3', 12),
('class4', '12/11/15 20:15:20', 'R4', 14),
('class5', '12/11/15 20:15:20', 'R3', 15),
('class6', '12/11/15 13:20:20', 'R2', 14),
('class7', '12/11/15 10:10:10', 'R3', 14);

SELECT * FROM CLASS;

INSERT INTO ENROLLED VALUES
(1, 'class1'),
(2, 'class1'),
(3, 'class3'),
(4, 'class3'),
(5, 'class4'),
(1, 'class5'),
(2, 'class5'),
(3, 'class5'),
(4, 'class5'),
(5, 'class5');

SELECT * FROM ENROLLED;

/*Query-1*/

SELECT DISTINCT S.SNAME
FROM STUDENT S, CLASS C, ENROLLED E, FACULTY F
WHERE S.SNUM = E.SNUM AND E.CNAME = C.CNAME AND C.FID = F.FID AND F.FNAME = 'Harish' AND S.LVL = 'Jr';

/*Query-2*/

SELECT CNAME FROM CLASS
WHERE ROOM='R1' OR
CNAME IN (SELECT CNAME FROM ENROLLED GROUP BY CNAME HAVING COUNT(*)>=5);


/*Query-3*/

SELECT DISTINCT SNAME FROM STUDENT 
WHERE SNUM IN (SELECT E1.SNUM
FROM ENROLLED E1, ENROLLED E2, CLASS C1, CLASS C2
WHERE E1.SNUM = E2.SNUM AND E1.CNAME <> E2.CNAME
AND E1.CNAME = C1.CNAME AND E2.CNAME = C2.CNAME 
AND C1.MEETS_AT = C2.MEETS_AT);

/*Query-4*/

SELECT DISTINCT F.FNAME FROM FACULTY F
WHERE NOT EXISTS (SELECT ROOM FROM CLASS WHERE ROOM NOT IN 
(SELECT C0.ROOM FROM Class C0 WHERE C0.FID = F.FID ));

/*Query-5*/

SELECT DISTINCT F.FNAME FROM FACULTY F
WHERE 5 > (SELECT COUNT(E.SNUM)
FROM CLASS C, ENROLLED E
WHERE C.CNAME = E.CNAME AND C.FID = F.FID);

/*Query-6*/

SELECT DISTINCT SNAME FROM STUDENT 
WHERE SNUM NOT IN (SELECT SNUM FROM ENROLLED E );

/*Query-7*/

SELECT S0.AGE AGE, S0.LVL LVL FROM STUDENT S0 
GROUP BY S0.AGE
HAVING S0.LVL IN 
(SELECT S1.LVL FROM STUDENT S1
WHERE S1.AGE = S0.AGE GROUP BY S1.AGE
HAVING COUNT(*) >= ALL ( SELECT COUNT(*) FROM STUDENT S2 WHERE S2.AGE = S1.AGE GROUP BY S2.AGE) );







