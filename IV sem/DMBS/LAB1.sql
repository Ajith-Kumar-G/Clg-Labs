CREATE DATABASE INSURANCE;

USE INSURANCE;

CREATE TABLE PERSON(
DRIVER_ID CHAR(3) ,NAME VARCHAR(30) NOT NULL,ADDRESS VARCHAR(50),
PRIMARY KEY(DRIVER_ID)
);

CREATE TABLE CAR(
REGNO CHAR(10),MODEL VARCHAR(15),YEAR INT NOT NULL,
PRIMARY KEY(REGNO)
);

CREATE TABLE ACCIDENT(
REPORT_NUMBER INT,ACCIDENT_DATE VARCHAR(15) NOT NULL,LOCATION VARCHAR(20),
PRIMARY KEY(REPORT_NUMBER)
);

CREATE TABLE OWNS(
DRIVER_ID CHAR(3),REGNO CHAR(10),
PRIMARY KEY(DRIVER_ID,REGNO),
FOREIGN KEY(DRIVER_ID) REFERENCES PERSON(DRIVER_ID),
FOREIGN KEY(REGNO) REFERENCES CAR(REGNO)
);

CREATE TABLE PARTICIPATED(
DRIVER_ID CHAR(3),REGNO CHAR(10),REPORT_NUMBER INT,DAMAGE_AMOUNT INT NOT NULL,
PRIMARY KEY(DRIVER_ID,REGNO,REPORT_NUMBER),
FOREIGN KEY(DRIVER_ID) REFERENCES PERSON(DRIVER_ID),
FOREIGN KEY(REGNO) REFERENCES CAR(REGNO),
FOREIGN KEY(REPORT_NUMBER) REFERENCES ACCIDENT(REPORT_NUMBER)
);

INSERT INTO PERSON
VALUES 
("A01","Richard","Srinivas nagar"),
("A02","Pradeep","Rajaji nagar"),
("A03","Smith","Ashok nagar"),
("A04","Venu","N R Colony"),
("A05","John","Hanumanth nagar")
;
 
SELECT * FROM PERSON;
 
INSERT INTO CAR
VALUES 
("KAO52250","INDICA",1990),
("KAO31181","LANCER",1957),
("KAO95477","TOYOTA",1998),
("KAO53408","HONDA",2008),
("KAO41702","AUDI",2005)
;	

SELECT * FROM CAR;

INSERT INTO ACCIDENT
VALUES
(11,'01-JAN-03',"Mysuru Road"),
(12,'02-FEB-04',"South end Circle"),
(13,'21-JAN-03',"Bull Temple Road"),
(14,'17-FEB-08',"Mysuru Road"),
(15,'04-MAR-05',"Kanakpura Road")
;

SELECT * FROM ACCIDENT;

INSERT INTO OWNS
VALUES
("A01","KAO52250"),
("A02","KAO53408"),
("A03","KAO31181"),
("A04","KAO95477"),
("A05","KAO41702")
;

SELECT * FROM OWNS;

INSERT INTO PARTICIPATED
VALUES
("A01","KAO52250",11,10000),
("A02","KAO53408",12,50000),
("A03","KAO95477",13,25000),
("A04","KAO31181",14,3000),
("A05","KAO41702",15,5000)
;

SELECT * FROM PARTICIPATED;

/*Q-1*/

INSERT INTO CAR VALUES ("KA05MC001","Audi",2018);
INSERT INTO OWNS VALUES ("A03","KA05MC001");
INSERT INTO ACCIDENT VALUES (16,'01-MAR-19',"Bull Temple Road");
INSERT INTO PARTICIPATED VALUES ("A03","KA05MC001",16,75000);

/*Q-2*/

SELECT OWNS.DRIVER_ID, OWNS.REGNO FROM OWNS,CAR WHERE MODEL="INDICA" AND OWNS.REGNO=CAR.REGNO;

/*Q-3*/

SELECT REGNO FROM PARTICIPATED WHERE REPORT_NUMBER IN (SELECT REPORT_NUMBER FROM ACCIDENT WHERE ACCIDENT_DATE LIKE  "%03" OR  ACCIDENT_DATE LIKE  "%04" OR ACCIDENT_DATE LIKE  "%05");

/*Q-4*/

SELECT COUNT(LOCATION) TOTAL_ACCIDENTS_IN_MYSURU FROM ACCIDENT WHERE LOCATION LIKE "%Mysuru%";

/*Q-5*/

SELECT * FROM PERSON WHERE DRIVER_ID IN ( SELECT DRIVER_ID FROM PARTICIPATED WHERE DAMAGE_AMOUNT > (SELECT AVG(DAMAGE_AMOUNT) FROM PARTICIPATED ));

/*Q-6*/

SELECT COUNT(DRIVER_ID) FROM PARTICIPATED WHERE REPORT_NUMBER IN (SELECT REPORT_NUMBER FROM ACCIDENT WHERE ACCIDENT_DATE LIKE "%08" );

/*Q-7*/

DELETE FROM OWNS WHERE DRIVER_ID IN (SELECT DRIVER_ID FROM PERSON WHERE NAME="JOHN") AND REGNO IN (SELECT REGNO FROM CAR WHERE MODEL="AUDI");
