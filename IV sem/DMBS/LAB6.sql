CREATE DATABASE ORDERDB;
USE ORDERDB;

CREATE TABLE SALESMAN(
SALESMAN_ID INT PRIMARY KEY, 
NAME VARCHAR(30),
CITY VARCHAR(30),
COMMISSION VARCHAR(30)
);

CREATE TABLE CUSTOMER(
CUSTOMER_ID INT PRIMARY KEY,
CUST_NAME VARCHAR(30),
CITY VARCHAR(30),
GRADE INT,
SALESMAN_ID INT,
FOREIGN KEY(SALESMAN_ID) REFERENCES SALESMAN(SALESMAN_ID) ON DELETE SET NULL
);

CREATE TABLE ORDERS(
ORD_NO INT PRIMARY KEY,
PURCHASE_AMT FLOAT,
ORD_DATE DATE,
CUSTOMER_ID INT REFERENCES CUSTOMER(CUSTOMER_ID) ON DELETE CASCADE,
SALESMAN_ID INT REFERENCES SALESMAN(SALESMAN_ID) ON DELETE CASCADE
);


INSERT INTO SALESMAN VALUES
(1000, 'JOHN','BANGALORE','25%'),
(2000, 'RAVI','BANGALORE','20%'),
(3000, 'KUMAR','MYSORE','15%'),
(4000, 'SMITH','DELHI','30%'),
(5000, 'HARSHA','HYDERABAD','15%');

INSERT INTO CUSTOMER VALUES 
(10, 'PREETHI', 'BANGALORE',100, 1000),
(11, 'VIVEK', 'MANGALORE', 300, 1000),
(12, 'BHASKAR', 'CHENNAI', 400, 2000),
(13, 'CHETHAN', 'BANGALORE', 200, 2000),
(14, 'MAMATHA', 'BANGALORE', 400, 3000);

INSERT INTO ORDERS VALUES
(50, 5000, '2017-05-04', 10, 1000),
(51, 450, '2017-01-20', 10, 2000),
(52, 1000, '2017-02-24', 13, 2000),
(53, 3500, '2017-04-13', 14, 3000),
(54, 550, '2017-03-09', 12, 2000);

SELECT * FROM CUSTOMER;
SELECT * FROM ORDERS;
SELECT * FROM SALESMAN;

/*QUERY-1*/
SELECT GRADE, COUNT(CUSTOMER_ID) FROM CUSTOMER 
GROUP BY(GRADE) HAVING GRADE >(SELECT AVG(GRADE) FROM CUSTOMER WHERE CITY ='BANGALORE') ;

/*QUERY-2*/
SELECT NAME, S.SALESMAN_ID FROM SALESMAN S, CUSTOMER C
WHERE S.SALESMAN_ID =C.SALESMAN_ID GROUP BY(C.SALESMAN_ID) HAVING COUNT(*)>1; 

SELECT SALESMAN_ID, NAME FROM SALESMAN A
WHERE 1 < (SELECT COUNT(*) FROM CUSTOMER WHERE SALESMAN_ID=A.SALESMAN_ID);

/*QUERY-3*/

SELECT S.SALESMAN_ID, NAME, CUST_NAME, COMMISSION FROM SALESMAN S, CUSTOMER C
WHERE S.CITY = C.CITY 
UNION
SELECT S.SALESMAN_ID, NAME, 'NO ONE' CUST_NAME, COMMISSION FROM SALESMAN S
WHERE NOT CITY= ANY(SELECT CITY FROM CUSTOMER) ; 

/*QUERY-4*/

CREATE VIEW ELITESALESMAN(SALESMAN_ID,NAME,ORDER_DATE) AS
SELECT O.SALESMAN_ID, NAME, ORD_DATE FROM ORDERS O,SALESMAN S
WHERE O.SALESMAN_ID=S.SALESMAN_ID GROUP BY ORD_DATE HAVING MAX(PURCHASE_AMT);

SELECT * FROM ELITESALESMAN;

/*QUERY-5*/

DELETE FROM SALESMAN WHERE SALESMAN_ID=1000;

SELECT * FROM SALESMAN;